- name: Download all LLM models
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "/opt/nomad/models/llm/{{ item.filename }}"
    mode: '0644'
  loop: "{{ main_expert_models + coding_expert_models + math_expert_models + extract_expert_models }}"
  become: yes
  loop_control:
    loop_var: item

- name: Download all Text-to-Speech model files
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "/opt/nomad/models/tts/{{ item.filename }}"
    mode: '0644'
  loop: "{{ piper_voice_files }}"
  become: yes
  loop_control:
    loop_var: item

- name: Download all Vision models (URL-based)
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "/opt/nomad/models/vision/{{ item.filename }}"
    mode: '0644'
  loop: "{{ vision_models | selectattr('url', 'defined') | list }}"
  become: yes
  loop_control:
    loop_var: item

- name: Download all Vision models (Hub-based)
  ansible.builtin.script: "download_hf_repo.py {{ item.repo_id }} /opt/nomad/models/vision/{{ item.name }}"
  args:
    executable: "/home/{{ target_user }}/.local/bin/python3"
  loop: "{{ vision_models | selectattr('repo_id', 'defined') | list }}"
  become: yes
  loop_control:
    loop_var: item

- name: Download all Embedding models (Hub-based)
  ansible.builtin.script: "download_hf_repo.py {{ item.repo_id }} /opt/nomad/models/embedding/{{ item.name }}"
  args:
    executable: "/home/{{ target_user }}/.local/bin/python3"
  loop: "{{ embedding_models | selectattr('repo_id', 'defined') | list }}"
  become: yes
  loop_control:
    loop_var: item
