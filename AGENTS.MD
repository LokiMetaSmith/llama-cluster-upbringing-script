AI Agent Architecture: A Mixture of ExpertsThis project utilizes a Mixture of Experts (MoE) architecture to handle a wide range of tasks efficiently. Instead of relying on a single, monolithic model, the system is composed of multiple specialized AI agents. A primary "Router" agent analyzes incoming user requests and delegates them to the most suitable expert.This approach allows the cluster to use smaller, specialized models for specific tasks, leading to faster response times and more accurate results.The Agent Hierarchy1. The Router Agent (The Conductor)The core of the system is the Router Agent, which runs within the main pipecatapp service. This agent's primary responsibility is not to answer complex questions itself, but to understand the user's intent and delegate the task to the appropriate downstream service or tool.Role: To classify incoming queries and route them.Implementation: This agent is the main TwinService in ansible/roles/pipecatapp/files/app.py.Prompt File: ansible/roles/pipecatapp/files/prompts/router.txtKey Behavior: If a query doesn't fit a specific expert, the Router will handle it as a general conversational AI. Otherwise, it will use the route_to_expert tool to pass the query to a specialist. It is also the only agent that has access to the tool library.2. The Expert Agents (The Specialists)Expert agents are specialized LLMs deployed as separate services. They are designed to excel at a single, well-defined domain. The system includes the following experts by default:a. The Main ExpertThis is the general-purpose, conversational agent. It is the default destination for any query that does not require a specialist.Expert Name: mainRole: Handles general conversation, summarization, and acts as the fallback for the Router Agent.Models: Configured in group_vars/models.yaml under the expert_models.main key.b. The Coding ExpertThis agent is fine-tuned for programming and software development tasks.Expert Name: codingRole: Handles code generation, debugging, and questions about algorithms and system architecture.Prompt File: ansible/roles/pipecatapp/files/prompts/coding_expert.txtModels: Configured in group_vars/models.yaml under the expert_models.coding key.c. The Math ExpertA specialist for mathematical and quantitative reasoning.Expert Name: mathRole: Solves math problems and answers logic-based questions.Models: Configured in group_vars/models.yaml under the expert_models.math key.d. The Extract ExpertThis agent is optimized for extracting structured data from unstructured text.Expert Name: extractRole: Parses text to find and format specific information, like names, dates, or other data points.Models: Configured in group_vars/models.yaml under the expert_models.extract key.Tool-Using CapabilitiesOnly the Router Agent has access to the library of tools (e.g., ssh, code_runner, ansible). This is a deliberate design choice for security and predictability. When the Router determines that a task requires interacting with the outside world, it will select and use the appropriate tool itself, rather than passing that capability down to a specialized expert.Configuration and CustomizationThe personality, instructions, and capabilities of each agent are defined in simple text files located in the ansible/roles/pipecatapp/files/prompts/ directory.To change the behavior of the Router Agent, edit router.txt.To change the behavior of the Coding Expert, edit coding_expert.txt.You can easily create new experts by:Adding a new prompt file to the prompts directory.Defining a new model list for it in group_vars/models.yaml.Deploying it using the deploy_expert.yaml playbook.This modular design makes the system highly extensible and easy to adapt to new tasks and domains.
