# This file contains variables that are common to all hosts in the inventory.
# It's a good place to define default values that might be overridden by
# more specific group_vars files.

expected_cluster_size: "{{ groups['workers'] | length if 'workers' in groups else 1 }}"

# This variable dynamically determines the node ID based on the hostname.
# If the hostname is 'devbox', the ID is 10.
# If the hostname contains numbers (e.g. 'worker1'), it extracts them and adds 10 (worker1 -> 11).
# If the hostname has no numbers (e.g. 'loki'), it defaults to 11 to match the shell script fallback.
node_id: >-
  {{
    '10' if inventory_hostname == 'devbox'
    else (
      ((inventory_hostname | regex_search('[0-9]+')) | int + 10)
      if (inventory_hostname | regex_search('[0-9]+'))
      else '11'
    )
  }}

cluster_subnet_prefix: "10.0.0"
# Always force the private/static IP alias for cluster binding
cluster_ip: "{{ cluster_subnet_prefix + '.' + node_id }}"


ansible_python_interpreter: /usr/bin/python3

# This variable dynamically determines the IP address for Nomad to advertise.
# It is set to the default IPv4 address to align with the Nomad configuration
# which explicitly binds to IPv4.
advertise_ip: "{{ ansible_facts['default_ipv4']['address'] }}"

nomad_version: "1.7.7"
nomad_namespace: "default"
nomad_jobs_dir: "/opt/nomad/jobs"
nomad_volumes_dir: "/opt/nomad/volumes"
nomad_models_dir: "/opt/nomad/models"

# Standard Ports
consul_http_port: 8500
nomad_http_port: 4646
mqtt_port: 1883
mqtt_websocket_port: 9001
provisioning_api_port: 8002
home_assistant_port: 8123
router_port: 8080
router_count: 1
nanochat_port: 8005
frigate_port: 5000
archivist_port: 8008

# Standard Paths
consul_data_dir: "/opt/consul"
llxprt_code_dir: "/opt/llxprt-code"
llama_cpp_build_dir: "/opt/llama.cpp-build"
provisioning_api_dir: "/opt/provisioning_api"
cluster_infra_dir: "/opt/cluster-infra"
mcp_dir: "/opt/mcp"

# Pipecat application settings
pipecat_deployment_style: 'docker' # Can be 'raw_exec' or 'docker'
llama_api_service_name: "router-api"
use_summarizer: "false"
stt_service: "faster-whisper"
pipecat_app_dir: "/opt/pipecatapp"
pipecat_log_file: "/opt/pipecatapp/pipecat.log"
# ... existing variables ...
active_stt_provider: "faster-whisper"
active_stt_model_name: "tiny.en"

# 1. Generate a new, secure key
#python -c "import secrets; print(secrets.token_hex(32))"
# Example output: a1b2c3d4e5f6...

# 2. Hash the key (replace <your_key> with the output from the first command)
#echo -n "<your_key>" | sha256sum
# Example output: <hashed_key>  -
pipecat_api_keys: ""

# ... existing variables ...

# -- Storing Secrets with Ansible Vault --
# This is the plain text version. In a real environment, you should
# encrypt this variable. First, create an encrypted file:
#   ansible-vault create group_vars/secrets.yaml
# Then, add the following to that file:
#   openai_api_key: "sk-..."
# Your main playbook should then include:
#   vars_files:
#     - group_vars/secrets.yaml
# For now, we'll place it here for simplicity.
openai_api_key: "sk-your_openai_api_key_here"
openrouter_api_key: ""
hf_token: ""
jules_api_key: "your_jules_api_key_here"

# Home Assistant User and Group IDs
# These should match the user ID and group ID that the Home Assistant
# container runs as. This ensures that the configuration files on the
# host have the correct ownership. The default is 568.
home_assistant_uid: 568
home_assistant_gid: 568

# Home Assistant Long-Lived Access Token
# 1. Go to your Home Assistant UI -> Your Profile (bottom left)
# 2. Scroll down to "Long-Lived Access Tokens"
# 3. Click "Create Token", give it a name (e.g., "Ansible"), and copy the generated token here.
home_assistant_token: "your_long_lived_access_token_here"

# When set to true, this will prevent the Home Assistant Nomad job from
# automatically restarting after a crash. This is useful for debugging.
home_assistant_debug_mode: false

# Model definitions have been moved to group_vars/models.yaml

# Nanochat configuration
enable_nanochat: false
nanochat_platform: "gpu"

# Service Enablement Flags
enable_provisioning_api: true
enable_home_assistant: true
enable_frigate: false

# The default user for remote connections and service execution.
target_user: ubuntu
target_user_home: "/home/{{ target_user }}"

# --- Exo Configuration ---
# By default, Exo is disabled. To enable it, set this to true.
exo_enable: false
# The model Exo should run.
exo_model: "llama-3.2-1b"

# A list of all available experts. This is used to dynamically generate
# the Nomad jobs for each expert model.
experts:
  - main
  - coding
  - math
  - extract
  - vllm

# --- PXE Boot Configuration ---

# Select the operating system for the PXE server.
# Options: "debian" or "nixos". Defaults to "debian" for backward compatibility.
pxe_os: "debian"

# -- NixOS PXE Server Variables --
# These variables are only used if pxe_os is set to "nixos".

# The network interface on the PXE server for DHCP/TFTP/HTTP services.
pxe_interface: "enp0s8"

# The public SSH key to embed in the NixOS clients for root access.
# Replace this with your actual public key.
pxe_client_ssh_key: "ssh-rsa AAAA..."

# DHCP network configuration for NixOS clients and the pxe_server role.
pxe_subnet: "10.0.0.0"
pxe_netmask: "255.255.255.0"
pxe_range_start: "10.0.0.200"
pxe_range_end: "10.0.0.250"
pxe_router: "10.0.0.1"
